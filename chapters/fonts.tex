\ExplSyntaxOn

%% Load fontspec
\usepackage{fontspec,unicode-math}
% CRITICAL BUGFIX FOR unicode-math (see https://github.com/wspr/unicode-math/issues/227)
\makeatletter
\def\@cdots{\mathinner{\unicodecdots}}
\makeatother

%% Set the font directory
\cs_if_exist:NF\latexbokFontdir
	{\cs_gset:Npn\latexbokFontdir{fonts}}

%% Font features
\defaultfontfeatures{
	Numbers={Proportional,OldStyle},
	Ligatures={Historic,Common,Required,Contextual},
	Contextuals=Swash,
	SmallCapsFeatures={
		Letters=SmallCaps,
		Scale=0.96,
		Weight=0.8
	},
}
%% Main font: Libertine
%% Sans serif font: Biolinum
\usepackage[osf,p,tt=false]{libertine}
%% Monospace font: Bitstream Vera Sans
\setmonofont[Scale=0.9,
		Path=\latexbokFontdir/bitstream-vera/,
		ItalicFont=VeraMoIt.ttf,
		BoldItalicFont=VeraMoBI.ttf,
		BoldFont=VeraMoBd.ttf,
		Scale=MatchLowercase,
	]{VeraMono.ttf}
%% Title font: small-caps
%\cs_set_eq:NN\titleformat\scshape

%% Improvements
\usepackage{\latexbokFontdir/libertinehologopatch/libertinehologopatch}
\usepackage[supstfm=libertinesups]{superiors}
\DeclareMicrotypeSet{romansans}{
	encoding = {*},
	family = {rm*,sf*}
}
\DeclareMicrotypeSet[tracking]{scshape}{
	encoding = {*},
	shape = {sc,scit,si}
}
\microtypesetup{
	protrusion = romansans,
}

%% UTF and TIPA fonts
\cs_set_eq:NN\utffont\rmfamily
\cs_set_eq:NN\tipafont\sffamily

\ExplSyntaxOff
